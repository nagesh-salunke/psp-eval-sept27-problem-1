name: Autograde Java

on:
  push:
    branches:
      - main

jobs:
  build-and-test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: Set up Java
        uses: actions/setup-java@v3
        with:
          java-version: '17'

      - name: Compile Java
        run: |
          javac Solution.java

      - name: Run Tests
        run: |
          mkdir results
          for folder in tests/public tests/hidden; do
            for infile in tests/*.in; do
              outfile="results/$(basename $infile .in).out"
              java Solution < "$infile" > "$outfile"
              diff -q "$outfile" "tests/$(basename $infile .in).out" || echo "Test $(basename $infile) failed"
            done
          done
